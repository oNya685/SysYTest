// Adapted from DaviesGit/SysY_compiler:
// https://raw.githubusercontent.com/DaviesGit/SysY_compiler/master/test_sample/performance_test/04_spmv2.sy
// Variant of testfile13: different initial vector and iterations.

const int N = 10;
const int M = 30;
const int MOD = 10007;

int xptr[N + 1] = {0, 3, 6, 9, 12, 15, 18, 21, 24, 27, 30};
int yidx[M] = {
    0, 1, 3,
    1, 2, 4,
    2, 3, 5,
    3, 4, 6,
    4, 5, 7,
    5, 6, 8,
    6, 7, 9,
    7, 8, 0,
    8, 9, 1,
    9, 0, 2
};
int vals[M] = {
    2, 1, 3,
    3, 2, 4,
    4, 3, 5,
    5, 4, 1,
    1, 5, 2,
    2, 1, 3,
    3, 2, 4,
    4, 3, 5,
    5, 4, 1,
    1, 5, 2
};

int a[N] = {3, 1, 4, 1, 5, 9, 2, 6, 5, 3};
int b[N] = {};

void spmv(int n, int xptr[], int yidx[], int vals[], int b[], int x[]) {
    int i = 0;
    for (i = 0; i < n; i = i + 1) x[i] = 0;

    for (i = 0; i < n; i = i + 1) {
        int j = xptr[i];
        for (; j < xptr[i + 1]; ) {
            int idx = yidx[j];
            x[idx] = (x[idx] + vals[j]) % MOD;
            j = j + 1;
        }

        int bi = b[i];
        if (bi == 0) bi = 1;

        j = xptr[i];
        for (; j < xptr[i + 1]; ) {
            int idx = yidx[j];
            x[idx] = (x[idx] + vals[j] * (bi - 1)) % MOD;
            j = j + 1;
        }
    }
}

int main() {
    int it = 0;
    for (it = 0; it < 15; it = it + 1) {
        spmv(N, xptr, yidx, vals, a, b);
        spmv(N, xptr, yidx, vals, b, a);
    }

    int checksum = 0;
    int i = 0;
    for (i = 0; i < N; i = i + 1) checksum = (checksum + (a[i] % 1009)) % 1009;
    printf("%d\n", checksum);
    return 0;
}
