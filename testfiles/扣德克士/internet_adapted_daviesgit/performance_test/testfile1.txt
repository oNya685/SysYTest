// Adapted from DaviesGit/SysY_compiler:
// https://raw.githubusercontent.com/DaviesGit/SysY_compiler/master/test_sample/performance_test/00_bitset1.sy
// Changes:
// - Replace while with for (;cond;) loops (SysY 2025 grammar).
// - Remove starttime/stoptime/putarray/getint; use deterministic PRNG and print a checksum.
// - Downscale array sizes to keep runtime reasonable.

const int BITCOUNT = 30;
const int ARR_LEN = 32;

int bits[ARR_LEN] = {};

int setbit(int a[], int pos, int d) {
    int pow2[BITCOUNT + 1] = {};

    pow2[0] = 1;
    pow2[1] = pow2[0] * 2;
    pow2[2] = pow2[1] * 2;
    pow2[3] = pow2[2] * 2;
    pow2[4] = pow2[3] * 2;
    pow2[5] = pow2[4] * 2;
    pow2[6] = pow2[5] * 2;
    pow2[7] = pow2[6] * 2;
    pow2[8] = pow2[7] * 2;
    pow2[9] = pow2[8] * 2;
    pow2[10] = pow2[9] * 2;

    int i = 10;
    for (; i < BITCOUNT; ) {
        i = i + 1;
        pow2[i] = pow2[i - 1] * 2;
    }

    if (pos / BITCOUNT >= ARR_LEN) return 0;

    int v = 0;
    if (a[pos / BITCOUNT] / (pow2[pos % BITCOUNT]) % 2 != d) {
        if (a[pos / BITCOUNT] / (pow2[pos % BITCOUNT]) % 2 == 0)
            if (d == 1)
                v = pow2[pos % BITCOUNT];

        if (a[pos / BITCOUNT] / pow2[pos % BITCOUNT] % 2 == 1)
            if (d == 0)
                v = v - pow2[pos % BITCOUNT];
    }

    a[pos / BITCOUNT] = a[pos / BITCOUNT] + v;
    return 0;
}

int prng() {
    static int state = 17;
    state = state * 1103 + 7;
    state = state % 100000;
    if (state < 0) state = -state;
    return state;
}

int main() {
    const int OPS = 500;

    int left = OPS;
    for (; left > 0; ) {
        left = left - 1;
        int pos = prng() % (ARR_LEN * BITCOUNT + 17);
        int d = prng() % 2;

        if (pos % 31 == 0) {
            setbit(bits, pos, 1);
            continue;
        }
        setbit(bits, pos, d);
    }

    int checksum = 0;
    int i = 0;
    for (i = 0; i < ARR_LEN; i = i + 1) {
        checksum = checksum + (bits[i] % 9973);
        checksum = checksum % 9973;
    }

    printf("%d\n", checksum);
    return 0;
}
